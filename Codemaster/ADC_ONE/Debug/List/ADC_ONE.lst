*******************************************************************************
*                                                                             *
*              K1874BE96T C CROSS COMPILER Version 2.00.151126                *
*                          Copyright (C) 2012 NIIET                           *
*                                                                             *
*******************************************************************************

Warning[C17] .\ADC_ONE.c(117,38): Call to function 'inverse' without prototype
Warning[C17] .\ADC_ONE.c(174,54): Call to function 'inverse' without prototype
Warning[C24] .\ADC_ONE.c(176,51): Conversion may loose significant digits
Warning[C5] .\ADC_ONE.c(14,21): Bad #pragma interrupt
Warning[C166] .\ADC_ONE.c(15,20): Function declared in #pragma interrupt must return void and have no parameters
Warning[C78] .\ADC_ONE.c(15,20): Undefined function 'IRQ_uart_rx_tx' in #pragma interrupt
Warning[C83] .\ADC_ONE.c(80,0): Parameter 'spcon' is never used in function 'USART1_Init'
                    adc_init:
;FILE: .\ADC_ONE.c
;000053    void adc_init(unsigned char achannel)
;000055      ADC_EN = 0x05;
00000000    B1051D                         	LDB   _AH,#05h
00000003    C70100001D                     	STB   _AH,ADC_EN
;000056      ADC_CON = 0x01 | adc_mode | (achannel << 3);
00000008    19031C                         	SHLB  achannel?adc_init,#03h
0000000B    930116001C                     	ORB   achannel?adc_init,adc_mode
00000010    91011C                         	ORB   achannel?adc_init,#01h
00000013    C70100001C                     	STB   achannel?adc_init,ADC_CON
;000057    }
00000018    F0                             	RET   
.ENDF
                     adc_off:
;000060    void adc_off()
;000062      ADC_EN = 0x00;
00000019    C701000000                     	STB   00h,ADC_EN
;000063    }
0000001E    F0                             	RET   
.ENDF
                 USART1_Init:
;000067    void USART1_Init(unsigned char spcon)
;000070      WSR=15;
0000001F    B10F00                         	LDB   WSR,#0Fh
;000071      reg=IOC1;
00000022    B0001C                         	LDB   reg?USART1_Init,IOC1
;000072      reg|=0x20;
00000025    91201C                         	ORB   reg?USART1_Init,#20h
;000073      WSR=0;
00000028    1100                           	CLRB  WSR
;000074      IOC1=reg;
0000002A    B01C00                         	LDB   IOC1,reg?USART1_Init
;000075      SP_CON1=0x09;
0000002D    B1091C                         	LDB   _AL,#09h
00000030    C70100001C                     	STB   _AL,SP_CON1
;000076      BAUD_RATE1 = BAUD_LO_VAL;  //write Baud rate value
00000035    B1811C                         	LDB   _AL,#81h
00000038    C70100001C                     	STB   _AL,BAUD_RATE1
;000077      BAUD_RATE1 = BAUD_HI_VAL;
0000003D    B1801C                         	LDB   _AL,#80h
00000040    C70100001C                     	STB   _AL,BAUD_RATE1
;000078      __NOP();
00000045    FD                             	NOP   
;000079      __NOP();
00000046    FD                             	NOP   
;000080    }
00000047    F0                             	RET   
.ENDF
                  init_Timer:
;000084    void init_Timer(void){
;000087      WSR=15;
00000048    B10F00                         	LDB   WSR,#0Fh
;000088      reg=IOC1;
0000004B    B0001C                         	LDB   reg?init_Timer,IOC1
;000089      reg|=0x4;
0000004E    91041C                         	ORB   reg?init_Timer,#04h
;000090      WSR=0;
00000051    1100                           	CLRB  WSR
;000091      IOC1=reg;
00000053    B01C00                         	LDB   IOC1,reg?init_Timer
;000092      tmp1 = INT_MASK;
00000056    B0001C                         	LDB   tmp1?init_Timer,INT_MASK
;000093      tmp1 |= 0x01;
00000059    91011C                         	ORB   tmp1?init_Timer,#01h
;000094      INT_MASK = tmp1;
0000005C    B01C00                         	LDB   INT_MASK,tmp1?init_Timer
;000095      tmp = WSR;
0000005F    B0001C                         	LDB   tmp?init_Timer,WSR
;000096      WSR = (tmp & 0x80) | 0xF;
00000062    51801C1D                       	ANDB  _AH,tmp?init_Timer,#80h
00000066    910F1D                         	ORB   _AH,#0Fh
00000069    B01D00                         	LDB   WSR,_AH
;000097      TIMER1 = 0x000f;
0000006C    AD0F00                         	LDBZE TIMER1,#0Fh
;000098      WSR = (tmp & 0x80);
0000006F    71801C                         	ANDB  tmp?init_Timer,#80h
00000072    B01C00                         	LDB   WSR,tmp?init_Timer
;000099                         }
00000075    F0                             	RET   
.ENDF
                 first_start:
;000103     void first_start ()
00000076    C824                           	PUSH  _EX
;000108            for (i=0;i<3;i++)
00000078    C301120000                     	ST    00h,i
0000007D    2041                           	SJMP  ??_1_CHECK
                   ??_1_LOOP:
;000109                    {
;000110                    adc_init(i);
0000007F    B30112001C                     	LDB   _AL,i
00000084    2F7A                           	SCALL adc_init
;000111                    __NOP ();
00000086    FD                             	NOP   
;000112                    __NOP ();
00000087    FD                             	NOP   
;000113                    __NOP ();
00000088    FD                             	NOP   
;000114                    adc_busy=ADC_RESULT&0x8000;
00000089    A30100001C                     	LD    adc_busy?first_start,ADC_RESULT
0000008E    6100801C                       	AND   adc_busy?first_start,#8000h
;000115                            if (adc_busy==0)
00000092    88001C                         	CMP   adc_busy?first_start,0
00000095    D71D                           	JNE   ??_2_ELSE
;000116                            {
;000117                            mas[i]=inverse(ADC_RESULT);
00000097    A301120024                     	LD    _EX,i
0000009C    090224                         	SHL   _EX,#02h
0000009F    A30100001C                     	LD    _AX,ADC_RESULT
000000A4    EF59FF                         	LCALL inverse
000000A7    EF56FF                         	LCALL ??FPCONV16
000000AA    C32500001C                     	ST    _AX,mas[_EX]
000000AF    C32502001E                     	ST    _BX,(mas+2)[_EX]
;000118                            }
                   ??_2_ELSE:
;000119                    }
000000B4    A30112001C                     	LD    _AX,i
000000B9    071C                           	INC   _AX
000000BB    C30112001C                     	ST    _AX,i
                  ??_1_CHECK:
000000C0    A30112001C                     	LD    _AX,i
000000C5    8903001C                       	CMP   _AX,#0003h
000000C9    D3B4                           	JNC   ??_1_LOOP
;000121     }
000000CB    CC24                           	POP   _EX
000000CD    F0                             	RET   
.ENDF
                        main:
;000123    void main ()
000000CE    C824                           	PUSH  _EX
000000D0    C826                           	PUSH  _FX
000000D2    C828                           	PUSH  _GX
000000D4    69040018                       	SUB   _SP,#0004h
;000129    __EI();
000000D8    FB                             	EI    
;000132      adc_mode=(0x00 << 1);
000000D9    C701160000                     	STB   00h,adc_mode
;000133      i=3;
000000DE    AD031C                         	LDBZE _AX,#03h
000000E1    C30112001C                     	ST    _AX,i
;000134      first_start();
000000E6    2F8E                           	SCALL first_start
;000135      k=0;
000000E8    C701170000                     	STB   00h,k
;000136      timer_convertion=0;
000000ED    C7011B0000                     	STB   00h,timer_convertion
;000137      init_Timer();
000000F2    2F54                           	SCALL init_Timer
;000139      USART1_Init(SP_MODE_1);
000000F4    B1091C                         	LDB   _AL,#09h
000000F7    2F26                           	SCALL USART1_Init
;000140      adc_init(k);
000000F9    B30117001C                     	LDB   _AL,k
000000FE    2F00                           	SCALL adc_init
;000141      led_blink=0x01;
00000100    B1011C                         	LDB   _AL,#01h
00000103    C70118001C                     	STB   _AL,led_blink
;000142       IOPORT1 = 0x00;
00000108    1100                           	CLRB  IOPORT1
;000144      while (1)
                     ??_3_DO:
;000145    {
;000146        if (timer_convertion==1)
0000010A    B3011B001C                     	LDB   _AL,timer_convertion
0000010F    99011C                         	CMPB  _AL,#01h
00000112    D7F6                           	JNE   ??_3_DO
;000147        {
;000148                     timer_convertion=0;
00000114    C7011B0000                     	STB   00h,timer_convertion
;000156                                 ByteReceived = SBUF_RX1;
00000119    B30100001C                     	LDB   _AL,SBUF_RX1
0000011E    C70114001C                     	STB   _AL,ByteReceived
;000158                    if  (ByteReceived==228)
00000123    99E41C                         	CMPB  _AL,#0E4h
00000126    D702                           	JNE   ??_5_ELSE
;000159                            {
;000160                            __NOP ();
00000128    FD                             	NOP   
;000161                            __NOP ();
00000129    FD                             	NOP   
;000162                            }
                   ??_5_ELSE:
;000165                    if (ByteReceived==13)    //разрешение передачи данных по УАРТ
0000012A    990D1C                         	CMPB  _AL,#0Dh
0000012D    D7DB                           	JNE   ??_3_DO
;000166                            {
;000167                            adc_busy=ADC_RESULT&0x8000;
0000012F    A30100001C                     	LD    adc_busy?main,ADC_RESULT
00000134    6100801C                       	AND   adc_busy?main,#8000h
;000168                            if (adc_busy==0)
00000138    88001C                         	CMP   adc_busy?main,0
0000013B    D7CD                           	JNE   ??_3_DO
;000169                                    {
;000174                                            ADCRES=inverse(ADC_RESULT);
0000013D    A30100001C                     	LD    _AX,ADC_RESULT
00000142    EFBBFE                         	LCALL inverse
00000145    C3010C001C                     	ST    _AX,ADCRES
;000175                                            mas[k]=mas[k]+(1-alfa)*(ADCRES-mas[k]);
0000014A    AF01170028                     	LDBZE _GX,k
0000014F    090228                         	SHL   _GX,#02h
00000152    AF01170024                     	LDBZE _EX,k
00000157    090224                         	SHL   _EX,#02h
0000015A    AD001C                         	LDBZE _AX,#00h
0000015D    A1803F1E                       	LD    _BX,#3F80h
00000161    A301000020                     	LD    _CX,alfa
00000166    A301020022                     	LD    _DX,(alfa+2)
0000016B    EF92FE                         	LCALL ??FPSUB
0000016E    C318001C                       	ST    _AX,00h[_SP]
00000172    C318021E                       	ST    _BX,02h[_SP]
00000176    AF01170026                     	LDBZE _FX,k
0000017B    090226                         	SHL   _FX,#02h
0000017E    A3010C001C                     	LD    _AX,ADCRES
00000183    EF7AFE                         	LCALL ??FPCONV16
00000186    A327000020                     	LD    _CX,mas[_FX]
0000018B    A327020022                     	LD    _DX,(mas+2)[_FX]
00000190    EF6DFE                         	LCALL ??FPSUB
00000193    A3180020                       	LD    _CX,00h[_SP]
00000197    A3180222                       	LD    _DX,02h[_SP]
0000019B    EF62FE                         	LCALL ??FPMUL
0000019E    A325000020                     	LD    _CX,mas[_EX]
000001A3    A325020022                     	LD    _DX,(mas+2)[_EX]
000001A8    EF55FE                         	LCALL ??FPADD
000001AB    C32900001C                     	ST    _AX,mas[_GX]
000001B0    C32902001E                     	ST    _BX,(mas+2)[_GX]
;000176                                            clon=mas[k];
000001B5    AF01170020                     	LDBZE _CX,k
000001BA    090220                         	SHL   _CX,#02h
000001BD    A32100001C                     	LD    _AX,mas[_CX]
000001C2    A32102001E                     	LD    _BX,(mas+2)[_CX]
000001C7    EF36FE                         	LCALL ??FPTRUNC
000001CA    C30110001C                     	ST    _AX,clon
;000178                                            SBUF_TX1 =k;
000001CF    B30117001C                     	LDB   _AL,k
000001D4    C70100001C                     	STB   _AL,SBUF_TX1
;000179                                            __NOP ();
000001D9    FD                             	NOP   
;000180                                            __NOP ();
000001DA    FD                             	NOP   
;000182                                            while (clon!=0)
000001DB    203C                           	SJMP  ??_8_CONTINUE
                     ??_8_DO:
;000183                                                    {
;000184                                                    tmp = WSR;
000001DD    B0001D                         	LDB   tmp?main,WSR
;000185                                                    WSR=0;
000001E0    1100                           	CLRB  WSR
;000186                                                    status_uart = SP_STAT1;
000001E2    B30100001C                     	LDB   _AL,SP_STAT1
000001E7    C7011A001C                     	STB   _AL,status_uart
;000187                                                    WSR = tmp;
000001EC    B01D00                         	LDB   WSR,tmp?main
;000188                                                    if ((status_uart&0x8)!=0)
000001EF    71081C                         	ANDB  _AL,#08h
000001F2    98001C                         	CMPB  _AL,0
000001F5    DF22                           	JE    ??_9_ELSE
;000189                                                            {
;000190                                                            rab=clon&SDV_Low;
000001F7    B30110001C                     	LDB   _AL,clon
000001FC    730104001C                     	ANDB  _AL,SDV_Low
00000201    C70119001C                     	STB   _AL,rab
;000191                                                            SBUF_TX1 = rab;
00000206    C70100001C                     	STB   _AL,SBUF_TX1
;000192                                                            clon=clon>>8;
0000020B    A30110001C                     	LD    _AX,clon
00000210    08081C                         	SHR   _AX,#08h
00000213    C30110001C                     	ST    _AX,clon
;000193                                                            __NOP ();
00000218    FD                             	NOP   
;000194                                                            }
                   ??_9_ELSE:
;000195                                                    }   //while clon!=0
               ??_8_CONTINUE:
00000219    A30110001C                     	LD    _AX,clon
0000021E    88001C                         	CMP   _AX,0
00000221    D7BA                           	JNE   ??_8_DO
;000198                                            __NOP ();
00000223    FD                             	NOP   
;000199                                            __NOP ();
00000224    FD                             	NOP   
;000201                                            if (k<2)
00000225    B30117001C                     	LDB   _AL,k
0000022A    99021C                         	CMPB  _AL,#02h
0000022D    DB0E                           	JC    ??_10_ELSE
;000202                                            {
;000203                                            k++;
0000022F    B30117001C                     	LDB   _AL,k
00000234    171C                           	INCB  _AL
00000236    C70117001C                     	STB   _AL,k
;000204                                            }
0000023B    2005                           	SJMP  ??_10_END
                  ??_10_ELSE:
;000206                                            {
;000207                                            k=0;
0000023D    C701170000                     	STB   00h,k
;000208                                            }
                   ??_10_END:
;000209                                            adc_init(k);
00000242    B30117001C                     	LDB   _AL,k
00000247    2DB7                           	SCALL adc_init
;000213                                    }//ADC_RESULT&0x8000==0
;000215                            }//if (ByteReceived==13)
;000217        } //if (timer_convertion==1)
;000218    }// while (1)
00000249    26BF                           	SJMP  ??_3_DO
;000219    }//main
0000024B    65040018                       	ADD   _SP,#0004h
0000024F    CC28                           	POP   _GX
00000251    CC26                           	POP   _FX
00000253    CC24                           	POP   _EX
00000255    F0                             	RET   
.ENDF
                ?INTERRUPT00:
                   timer_irq:
;000222        void    timer_irq()
00000000    F4                             	PUSHA 
00000001    C81C                           	PUSH  _AX
;000225      tmp = WSR;
00000003    B0001C                         	LDB   tmp?timer_irq,WSR
;000226      WSR = (tmp & 0x80) | 0xF;
00000006    51801C1D                       	ANDB  _AH,tmp?timer_irq,#80h
0000000A    910F1D                         	ORB   _AH,#0Fh
0000000D    B01D00                         	LDB   WSR,_AH
;000227      TIMER1 = 0x0001;
00000010    AD0100                         	LDBZE TIMER1,#01h
;000228      WSR = (tmp & 0x80);
00000013    71801C                         	ANDB  tmp?timer_irq,#80h
00000016    B01C00                         	LDB   WSR,tmp?timer_irq
;000229            timer_convertion=1;
00000019    B1011C                         	LDB   _AL,#01h
0000001C    C7011B001C                     	STB   _AL,timer_convertion
;000230            if (led_blink==0x01)
00000021    B30118001C                     	LDB   _AL,led_blink
00000026    99011C                         	CMPB  _AL,#01h
00000029    D70A                           	JNE   ??_11_ELSE
;000231                     {
;000232                     led_blink=0x00;
0000002B    C701180000                     	STB   00h,led_blink
;000233                      IOPORT1 = (0xfe);
00000030    B1FE00                         	LDB   IOPORT1,#0FEh
;000234                     }
00000033    200B                           	SJMP  ??_11_END
                  ??_11_ELSE:
;000236                     {
;000237                     led_blink=0x01;
00000035    B1011C                         	LDB   _AL,#01h
00000038    C70118001C                     	STB   _AL,led_blink
;000238                     IOPORT1 = (0xff);
0000003D    B1FF00                         	LDB   IOPORT1,#0FFh
;000239                     }
                   ??_11_END:
;000240            }
00000040    CC1C                           	POP   _AX
00000042    F5                             	POPA  
00000043    F0                             	RET   
.ENDF

.\ADC_ONE.c: 666 byte(s), 2982 line(s), 0 error(s), 7 warning(s)

